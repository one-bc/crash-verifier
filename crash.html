<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crash Game Verification</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    input, button { margin: 5px 0; padding: 5px; }
  </style>
</head>
<body>
  <h1>Crash - Game Verification</h1>

  <label>Game Hash: <input id="gameHash" size="70"></label><br>
  <label>Salt: <input id="salt" size="70"></label><br>
  <label>Amount of Games: <input id="games" type="number" value="10"></label><br>
  <button onclick="verify()">Verify</button>

  <table id="results">
    <thead>
      <tr><th>Game #</th><th>Hash</th><th>Bust</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // SHA256 计算函数
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // Bust 计算公式（简化版）
    function calculateBust(hash) {
      // 取 hash 的前 52 位（13 hex）
      const hex = hash.slice(0, 13);
      const r = parseInt(hex, 16);
      const X = r / Math.pow(2, 52);
      let result = 99 / (1 - X);
      if (result < 100) result = 100; // 小于 100 强制为 100
      return (result / 100).toFixed(2);
    }

    async function verify() {
      const gameHash = document.getElementById("gameHash").value.trim();
      const salt = document.getElementById("salt").value.trim();
      const games = parseInt(document.getElementById("games").value);

      let hash = gameHash;
      const tbody = document.querySelector("#results tbody");
      tbody.innerHTML = "";

      for (let i = 0; i < games; i++) {
        const combined = hash + salt;
        hash = await sha256(combined); // 生成下一个 hash
        const bust = calculateBust(hash);

        const row = `<tr><td>${i+1}</td><td>${hash}</td><td>${bust}</td></tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      }
    }
  </script>
</body>
</html>
